<html>
  <head>
  </head>
  <body>
  <h1>HI THERE <span id="local-ip"></span></h1>

  <div id="dj-view">
    Add files to your set
    <input id="file-selector" type="file">
    <ul id="files">
    </ul>
  </div>

  <button id="spawn">Start your set</button>

    <script>

      var fs = require('fs')
      var getLocalIp = require('./src/util/localip.js').getLocalIp
      function log(x) { document.getElementById('local-ip').innerText = x }
      getLocalIp(log)

      // TODO add drag and drop support
      var filePicker = document.getElementById('file-selector')
      var fileList = document.getElementById('files')
      filePicker.addEventListener('change', function displayFile(event) {
        console.log(this.value)
        var splitFileName = this.value.split('/')
        var item = document.createElement('li')
        item.innerText = splitFileName[splitFileName.length - 1]
        item.__filepath = this.value
        fileList.appendChild(item)
      })

      var express = require('express')
      function spawnYouAServer() {
        console.log('spawning!')
        var app = express()
        var stream = fs.createReadStream('./media/goodtime.mp3');
        app.get('/', function(req,res) {
            res.set({'Content-Type': 'audio/mpeg'});
            stream.pipe(res);
           // res.send('A NEW FUCKING SERVER')
        })
        app.listen(6799)
      }
      var spawnButton = document.getElementById('spawn')
      spawnButton.addEventListener('click', spawnYouAServer)
    </script>
  </body>
</html>
